<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NASA Bio-Exploration Dashboard (NBED)</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom Font and base styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fc; /* Light NASA-inspired background */
        }
        /* Custom scrollbar for better aesthetics */
        .custom-scroll::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background-color: #a8a8a8;
            border-radius: 4px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background-color: #e4e4e4;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'nasa-blue': '#1e3a8a',
                        'nasa-red': '#f87171',
                        'nasa-gray': '#4b5563',
                        'mars-red': '#cc523b',
                        'moon-gray': '#d1d5db',
                    }
                }
            }
        }

        // ----------------------------------------------------------------------
        // --- STEP 1: REPLACE THIS SECTION WITH YOUR 608 PROCESSED JSON DATA ---
        // ----------------------------------------------------------------------
        // The data must be an array of objects, with these required, AI-derived fields:
        // { 
        //   title, topic, factor, organism, impact, conclusion, 
        //   riskLevel (Critical, High, Medium, Low, Contradictory), 
        //   isContradictory (boolean), 
        //   missionRisk (e.g., High - Long Duration), 
        //   gap (AI-identified research gap)
        // }
        
        const MOCK_KG_RESULTS = [
            { id: 1, title: "Microgravity Effects on Mouse Musculoskeletal System", topic: "Musculoskeletal", factor: "Microgravity", organism: "Mouse", impact: "Severe bone density loss (osteopenia) in femur, 20% reduction.", conclusion: "Requires 100% effective resistive exercise. High risk for Mars mission.", riskLevel: "High", isContradictory: false, missionRisk: "High - Long Duration", gap: "Bone recovery post-mission." },
            { id: 2, title: "Radiation Impact on Arabidopsis thaliana Gene Expression", topic: "Plant Biology", factor: "Radiation", organism: "Arabidopsis thaliana", impact: "Upregulation of DNA repair genes. Reduced yield of biomass.", conclusion: "Plants show resilience but require heavy shielding or specialized cultivars.", riskLevel: "Medium", isContradictory: false, missionRisk: "Medium - Surface", gap: "Combined radiation and low pressure effects." },
            { id: 3, title: "Psychological Stress and Immune Response in Astronauts", topic: "Human Health", factor: "Isolation & Stress", organism: "Human", impact: "Significant drop in T-cell count during 6-month ISS missions.", conclusion: "Psychosocial support is critical; immune monitoring needed.", riskLevel: "High", isContradictory: false, missionRisk: "High - Long Duration", gap: "Validated in-flight immune boost technology." },
            { id: 4, title: "Microgravity effects on Yeast Cell Wall Integrity", topic: "Microbial Ecology", factor: "Microgravity", organism: "Yeast (S. cerevisiae)", impact: "Increased cell wall thickness and virulence/antibiotic resistance.", conclusion: "Microbes are a latent threat in space. Requires new disinfection protocols.", riskLevel: "High", isContradictory: false, missionRisk: "High - Habitat/Suit", gap: "Effective microbial control in partial-G." },
            { id: 5, title: "Conflicting Data on Fluid Shifts and Ocular Syndrome (SANS)", topic: "Human Health", factor: "Microgravity", organism: "Human", impact: "Some report optic disc swelling, others report no change.", conclusion: "The root cause of SANS remains unclear, requires multi-omics data integration.", riskLevel: "Contradictory", isContradictory: true, missionRisk: "Critical - Vision", gap: "Definitive mechanism of SANS pathology." },
            { id: 6, title: "Partial Gravity Simulation on Rat Muscle Atrophy", topic: "Musculoskeletal", factor: "Hypergravity", organism: "Rat", impact: "Hypergravity analog partially mitigated muscle atrophy effects of simulated microgravity.", conclusion: "Partial-G on Mars/Moon offers natural countermeasure benefits.", riskLevel: "Low", isContradictory: false, missionRisk: "Low - Surface", gap: "True partial gravity exposure (Moon/Mars)." },
            { id: 7, title: "Regolith Toxicity on Cyanobacteria Growth", topic: "Plant Biology", factor: "Lunar Regolith", organism: "Cyanobacteria", impact: "Reduced photosynthetic efficiency when exposed to simulated lunar dust.", conclusion: "In-situ resource utilization (ISRU) biomass production may be limited by dust toxicity.", riskLevel: "Medium", isContradictory: false, missionRisk: "Medium - Surface", gap: "Regolith detoxification methods." },
            { id: 8, title: "Circadian Rhythm Disruption in Fruit Flies", topic: "Human Health", factor: "Altered Lighting/Time", organism: "Fruit Fly", impact: "Significant desynchronization of internal clock genes.", conclusion: "Lighting protocols need rigorous optimization for long-duration missions.", riskLevel: "Medium", isContradictory: false, missionRisk: "Medium - Transit", gap: "Non-pharmaceutical circadian entrainment." },
            { id: 9, title: "Elevated CO2 for Closed-Loop Crop Growth", topic: "Food Production", factor: "CO2 Levels", organism: "Wheat", impact: "Elevated $\text{CO}_2$ boosts growth rate by $15\%$, but nutrient density slightly reduced.", conclusion: "CO2 recycling offers significant advantage, but harvest protocols must account for nutritional shifts.", riskLevel: "Low", isContradictory: false, missionRisk: "Low - Habitat/ISRU", gap: "Nutrient density management under high $\text{CO}_2$." },
            { id: 10, title: "DSRE Simulation on Human Lymphocytes", topic: "Human Health", factor: "Radiation", organism: "Human Cell", impact: "Significant induction of double-strand DNA breaks, minimal repair effectiveness observed in simulated deep space radiation environment.", conclusion: "Requires advanced autonomous cell repair or heavy transit shielding for crews.", riskLevel: "Critical", isContradictory: false, missionRisk: "Critical - Transit", gap: "Development of effective radioprotectants." },
        ];
        // ----------------------------------------------------------------------
        // --- END OF MOCK DATA SECTION ---
        // ----------------------------------------------------------------------


        // ----------------------------------------------------------------------
        // --- STEP 2: DYNAMICALLY CALCULATE CONSTANTS BASED ON NEW DATA SIZE ---
        // ----------------------------------------------------------------------
        const TOTAL_PUBLICATIONS = 608;
        const MOCK_RESULT_COUNT = MOCK_KG_RESULTS.length;
        // These constants are calculated dynamically, so they will automatically
        // adjust when you replace MOCK_KG_RESULTS with your 608 processed entries.
        const FACTORS = [...new Set(MOCK_KG_RESULTS.map(r => r.factor))].sort();
        const ORGANISMS = [...new Set(MOCK_KG_RESULTS.map(r => r.organism))].sort();
        const TOPICS = [...new Set(MOCK_KG_RESULTS.map(r => r.topic))].sort();
        const RISK_TYPES = ['Critical - Vision', 'High - Long Duration', 'Medium - Surface', 'Low - Surface', 'High - Habitat/Suit', 'Medium - Transit', 'Critical - Transit'].sort();
        
        // Updated Factors Map with new entry
        const FACTORS_MAP = {
            "Microgravity": { icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><circle cx="12" cy="12" r="10"/><path d="M12 2a10 10 0 0 1 0 20z" opacity="0.3"/><path d="M12 18v-6l4-2"/><path d="M12 6v6l-4 2"/></svg>`, desc: "Zero-G environment effects." },
            "Radiation": { icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><path d="M12 2v20"/><path d="M17 5l-5 5-5-5"/><path d="M17 19l-5-5-5 5"/></svg>`, desc: "GCR and solar particle event exposure." },
            "Isolation & Stress": { icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><path d="M16 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/><path d="M17.92 14.65l.68.79a2 2 0 0 1-.3 2.8l-1.42 1.42a2 2 0 0 1-2.8.3l-.79-.68"/></svg>`, desc: "Psychosocial and confinement stress." },
            "Hypergravity": { icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><path d="M12 2v20m5-5l-5 5-5-5"/></svg>`, desc: "Partial-G analog simulation (Moon/Mars)." },
            "Lunar Regolith": { icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" opacity="0.3"/><path d="M12 22a10 10 0 0 0 6-17.5"/><path d="M12 22a10 10 0 0 1-6-17.5"/></svg>`, desc: "Dust and particulate toxicity." },
            "Altered Lighting/Time": { icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>`, desc: "Circadian rhythm disruption." },
            "CO2 Levels": { icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>`, desc: "Atmospheric composition variability." },
        };

        // State management
        let selectedFactor = 'All';
        let selectedOrganism = 'All';
        let selectedTopic = 'All';
        let isAuthReady = false;
        let db, auth;
        let userId = 'simulated-user'; // Default for mock data

        // Utility to get the right color for a risk level (used only for the overall text label)
        const getRiskColor = (risk) => {
            switch (risk.split(' - ')[0]) {
                case 'Critical': return 'bg-red-500 text-white';
                case 'High': return 'bg-yellow-500 text-gray-900';
                case 'Medium': return 'bg-blue-400 text-white';
                case 'Low': return 'bg-green-500 text-white';
                case 'Contradictory': return 'bg-purple-500 text-white';
                default: return 'bg-gray-500 text-white';
            }
        };

        // --- NEW NON-TRADITIONAL VISUAL FUNCTIONS ---

        // Utility to map risk level to a percentage and bar color for the gauge
        const getRiskGaugeStyle = (riskLevel) => {
            let width = 0;
            let barColor = 'bg-gray-400';
            let labelColor = 'text-gray-600';
            
            // Map risk levels to visual severity percentage
            switch (riskLevel) {
                case 'Critical': width = 100; barColor = 'bg-red-600'; labelColor = 'text-red-700'; break;
                case 'High': width = 75; barColor = 'bg-yellow-500'; labelColor = 'text-yellow-700'; break;
                case 'Medium': width = 50; barColor = 'bg-blue-500'; labelColor = 'text-blue-700'; break;
                case 'Low': width = 25; barColor = 'bg-green-500'; labelColor = 'text-green-700'; break;
                case 'Contradictory': width = 80; barColor = 'bg-purple-500'; labelColor = 'text-purple-700'; break; // High risk due to uncertainty
                default: width = 0;
            }
            return { width: width, color: barColor, labelColor: labelColor };
        };

        // Renders the HTML for the Risk Gauge Visualization (Non-traditional summary)
        const getRiskGaugeHtml = (riskLevel, missionRisk) => {
            const style = getRiskGaugeStyle(riskLevel);
            const displayLabel = missionRisk.split(' - ')[0]; // E.g., Critical, High
            
            return `
                <div class="text-xs font-semibold uppercase text-right mb-1 ${style.labelColor}">${displayLabel} Risk</div>
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                    <div class="h-2.5 rounded-full transition-all duration-700 ease-out ${style.color}" style="width: ${style.width}%" title="${missionRisk}"></div>
                </div>
            `;
        }

        // --- RENDERING FUNCTIONS ---

        /**
         * Renders the filter selection controls (Factors, Organisms, Topics).
         */
        function renderFilters() {
            const factorFilterHtml = FACTORS.map(f => `
                <option value="${f}" ${selectedFactor === f ? 'selected' : ''}>${f}</option>
            `).join('');

            const organismFilterHtml = ORGANISMS.map(o => `
                <option value="${o}" ${selectedOrganism === o ? 'selected' : ''}>${o}</option>
            `).join('');
            
            const topicFilterHtml = TOPICS.map(t => `
                <option value="${t}" ${selectedTopic === t ? 'selected' : ''}>${t}</option>
            `).join('');

            document.getElementById('filters-container').innerHTML = `
                <div class="space-y-4 md:space-y-0 md:flex md:space-x-4">
                    <!-- Factor Filter -->
                    <div class="flex-1">
                        <label for="factor-filter" class="block text-sm font-medium text-nasa-gray mb-1">Space Factor:</label>
                        <select id="factor-filter" onchange="handleFilterChange('factor', this.value)"
                            class="block w-full rounded-md border-gray-300 shadow-sm focus:border-nasa-blue focus:ring-nasa-blue p-2.5 transition duration-150 ease-in-out bg-white border">
                            <option value="All">All Factors (${FACTORS.length})</option>
                            ${factorFilterHtml}
                        </select>
                    </div>

                    <!-- Organism Filter -->
                    <div class="flex-1">
                        <label for="organism-filter" class="block text-sm font-medium text-nasa-gray mb-1">Model Organism:</label>
                        <select id="organism-filter" onchange="handleFilterChange('organism', this.value)"
                            class="block w-full rounded-md border-gray-300 shadow-sm focus:border-nasa-blue focus:ring-nasa-blue p-2.5 transition duration-150 ease-in-out bg-white border">
                            <option value="All">All Organisms (${ORGANISMS.length})</option>
                            ${organismFilterHtml}
                        </select>
                    </div>
                    
                    <!-- Topic Filter -->
                    <div class="flex-1">
                        <label for="topic-filter" class="block text-sm font-medium text-nasa-gray mb-1">Research Topic:</label>
                        <select id="topic-filter" onchange="handleFilterChange('topic', this.value)"
                            class="block w-full rounded-md border-gray-300 shadow-sm focus:border-nasa-blue focus:ring-nasa-blue p-2.5 transition duration-150 ease-in-out bg-white border">
                            <option value="All">All Topics (${TOPICS.length})</option>
                            ${topicFilterHtml}
                        </select>
                    </div>
                </div>
            `;
        }

        /**
         * Renders the list of filtered publications/results.
         * @param {Array} results - The filtered results array.
         */
        function renderResults(results) {
            const container = document.getElementById('results-list');
            container.classList.add('custom-scroll'); // Apply custom scrollbar styling
            if (results.length === 0) {
                container.innerHTML = `
                    <div class="text-center p-12 bg-white rounded-xl shadow-inner border border-dashed border-gray-300">
                        <p class="text-xl text-nasa-gray font-semibold mb-2">No Results Found</p>
                        <p class="text-gray-500">Try adjusting your filters to broaden your search for bioscience publications.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = results.map(r => `
                <div class="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition duration-300 border border-gray-100 space-y-3">
                    <div class="flex items-center justify-between">
                        <h3 class="text-xl font-bold text-nasa-blue leading-snug">${r.title}</h3>
                        <!-- REPLACED simple pill with Visual Risk Gauge -->
                        <div class="w-32 flex-shrink-0 ml-4">
                            ${getRiskGaugeHtml(r.riskLevel, r.missionRisk)}
                        </div>
                    </div>

                    <div class="flex flex-wrap gap-2 text-sm text-nasa-gray font-medium">
                        <span class="inline-flex items-center px-3 py-1 bg-moon-gray rounded-full">
                            ${FACTORS_MAP[r.factor].icon}
                            <span class="ml-1">${r.factor}</span>
                        </span>
                        <span class="inline-flex items-center px-3 py-1 bg-moon-gray rounded-full">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><path d="M14 19a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v4"/></svg>
                            <span class="ml-1">${r.organism}</span>
                        </span>
                        <span class="px-3 py-1 bg-moon-gray rounded-full">
                            ${r.topic}
                        </span>
                    </div>

                    <div class="pt-2">
                        <p class="text-base text-gray-700 font-semibold mb-1">Observed Impact:</p>
                        <p class="text-gray-600">${r.impact}</p>
                    </div>
                    <div>
                        <p class="text-base text-gray-700 font-semibold mb-1">Key Conclusion:</p>
                        <p class="text-gray-600">${r.conclusion}</p>
                    </div>
                    
                    <!-- Link to OSDR/Task Book - Simulated -->
                    <div class="flex justify-end pt-2">
                        <a href="https://science.nasa.gov/biological-physical/data/" target="_blank" class="text-sm text-nasa-blue font-semibold hover:text-blue-700 transition duration-150 ease-in-out">
                            View Related Data (OSDR / Task Book Link) &rarr;
                        </a>
                    </div>
                </div>
            `).join('');
        }

        /**
         * Renders the AI-generated insight and gap analysis summary.
         * @param {Array} results - The filtered results array.
         */
        function renderAiSummary(results) {
            const container = document.getElementById('ai-summary-container');
            if (results.length === 0) {
                container.innerHTML = `
                    <div class="p-6 bg-white rounded-xl shadow-lg border-l-4 border-nasa-gray">
                        <p class="text-lg font-semibold text-nasa-gray">Select criteria to generate a synthesized briefing report.</p>
                    </div>
                `;
                return;
            }

            // Simulate LLM processing
            const factor = selectedFactor === 'All' ? 'Space Environment' : selectedFactor;
            const organism = selectedOrganism === 'All' ? 'all studied model organisms' : selectedOrganism;
            const topic = selectedTopic === 'All' ? 'the entire biosciences corpus' : `the ${selectedTopic} research area`;
            
            // Gather key findings and risks for summarization
            const keyImpacts = results.map(r => `- ${r.impact}`).join('\n');
            const criticalGaps = [...new Set(results.map(r => r.gap))].slice(0, 3).map(g => `- ${g}`).join('\n');
            const contradictionCount = results.filter(r => r.isContradictory).length;

            let summaryText = `
                <p class="text-lg mb-4 text-gray-700 leading-relaxed">
                    Analyzing ${results.length} publication findings across ${topic} concerning the **${factor}** effect on **${organism}**, the synthesized conclusion is as follows:
                </p>
                
                <div class="p-4 rounded-lg bg-indigo-50 border border-indigo-200 mb-4">
                    <h4 class="font-bold text-nasa-blue mb-2 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 mr-2"><path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2z"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
                        Synthesized Conclusion & Risks
                    </h4>
                    <pre class="whitespace-pre-wrap text-sm text-gray-700">${keyImpacts}</pre>
                    ${contradictionCount > 0 ? `<p class="mt-3 text-sm text-purple-700 font-semibold">⚠️ Contradictory Findings Detected: ${contradictionCount} studies require further meta-analysis to resolve conflicting data (Filter: Contradictory).</p>` : ''}
                </div>

                <div class="p-4 rounded-lg bg-red-50 border border-red-200">
                    <h4 class="font-bold text-mars-red mb-2 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 mr-2"><path d="M21 12.01c-1.35 1.5-3.07 2.54-5 3.01l-2 4.48-2-4.48c-1.93-.47-3.65-1.51-5-3.01C5.1 8.92 4 4.8 4 4h16c0 .8.09 1.68.21 2.41z"/><circle cx="12" cy="12" r="2" opacity="0.4"/></svg>
                        Identified Knowledge Gaps (Mission Architect Focus)
                    </h4>
                    <pre class="whitespace-pre-wrap text-sm text-gray-700">${criticalGaps}</pre>
                </div>
            `;
            container.innerHTML = summaryText;
        }

        /**
         * Renders the interactive graph visualization simulation.
         * @param {Array} results - The filtered results array.
         */
        function renderGraphView(results) {
            const container = document.getElementById('graph-view');
            container.innerHTML = '';
            
            const uniqueFactors = [...new Set(results.map(r => r.factor))];
            const uniqueOrganisms = [...new Set(results.map(r => r.organism))];
            
            if (results.length === 0) {
                 container.innerHTML = `<p class="text-gray-500 text-center py-4">Filter results to see the relational map.</p>`;
                 return;
            }

            let graphHtml = `
                <div class="flex justify-between items-center text-sm font-semibold text-nasa-gray pb-2 border-b border-gray-200">
                    <span>${uniqueFactors.length} Unique Factors</span>
                    <span class="text-nasa-blue">&rArr;</span>
                    <span>${uniqueOrganisms.length} Unique Organisms</span>
                    <span class="text-nasa-blue">&rArr;</span>
                    <span>${results.length} Experiment Findings</span>
                </div>
                <div class="mt-4 space-y-4">
            `;

            uniqueFactors.forEach(factor => {
                const factorResults = results.filter(r => r.factor === factor);
                const organismsAffected = [...new Set(factorResults.map(r => r.organism))];
                
                graphHtml += `
                    <div class="border-l-4 border-nasa-blue pl-4">
                        <h4 class="font-bold text-nasa-blue text-md">${factor} (${factorResults.length} findings)</h4>
                        <div class="flex flex-wrap gap-2 mt-2">
                `;
                
                organismsAffected.forEach(organism => {
                    const organismResults = factorResults.filter(r => r.organism === organism);
                    const risk = organismResults.length > 0 ? organismResults[0].missionRisk : 'N/A'; // Simplified risk display
                    
                    graphHtml += `
                        <div class="px-3 py-1 text-xs font-semibold rounded-full border border-gray-300 shadow-sm transition duration-150 ease-in-out bg-white hover:bg-gray-50" title="${organismResults.length} impacts recorded. Risk: ${risk}">
                            ${organism} <span class="font-normal text-gray-500">(${organismResults.length})</span>
                        </div>
                    `;
                });

                graphHtml += `
                        </div>
                    </div>
                `;
            });

            graphHtml += `</div>`;
            container.innerHTML = graphHtml;
        }

        /**
         * The main function to filter data and re-render all sections of the dashboard.
         */
        function renderDashboard() {
            let filteredResults = MOCK_KG_RESULTS;

            if (selectedFactor !== 'All') {
                filteredResults = filteredResults.filter(r => r.factor === selectedFactor);
            }
            if (selectedOrganism !== 'All') {
                filteredResults = filteredResults.filter(r => r.organism === selectedOrganism);
            }
            if (selectedTopic !== 'All') {
                filteredResults = filteredResults.filter(r => r.topic === selectedTopic);
            }

            document.getElementById('result-count').textContent = `${filteredResults.length} Results from ${TOTAL_PUBLICATIONS} Publications (Showing ${MOCK_RESULT_COUNT} Mock Findings)`;
            
            renderFilters();
            renderAiSummary(filteredResults);
            renderGraphView(filteredResults);
            renderResults(filteredResults);
        }

        /**
         * Handles filter changes and triggers the dashboard re-render.
         * @param {string} filterType - 'factor', 'organism', or 'topic'.
         * @param {string} value - The new selected value.
         */
        function handleFilterChange(filterType, value) {
            if (filterType === 'factor') selectedFactor = value;
            else if (filterType === 'organism') selectedOrganism = value;
            else if (filterType === 'topic') selectedTopic = value;
            
            renderDashboard();
        }

        // --- INITIALIZATION ---

        /**
         * Initialize the application on window load.
         */
        window.onload = function() {
            // Note: Firebase setup is commented out as this is a front-end simulation
            isAuthReady = true;
            renderDashboard(); // Initial render for the simulation
        };
    </script>
</head>
<body class="min-h-screen">

    <div class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
        <!-- Header -->
        <header class="mb-8 border-b-4 border-nasa-blue pb-4">
            <h1 class="text-4xl font-extrabold text-nasa-blue flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8 mr-3 text-nasa-red">
                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                    <path d="M10 9l4 2-4 2V9z"/>
                </svg>
                NBED: Bio-Exploration Knowledge Engine
            </h1>
            <p class="text-lg text-nasa-gray mt-1">AI-Powered Synthesis of NASA Bioscience for Moon & Mars Missions.</p>
            
            <!-- Data Source Link -->
            <div class="mt-2 p-2 bg-indigo-100 rounded-md border border-indigo-300">
                <p class="text-sm text-indigo-800 font-medium">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 inline mr-1 align-text-bottom"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/></svg>
                    Source Data for Full Implementation: 
                    <a href="https://github.com/jgalazka/SB_publications/tree/main" target="_blank" class="text-nasa-blue hover:underline">
                        github.com/jgalazka/SB_publications
                    </a>
                </p>
            </div>
        </header>

        <!-- Filter Controls -->
        <section id="filters-container" class="mb-8 p-6 bg-white rounded-xl shadow-lg border border-gray-100"></section>

        <!-- Main Content Layout (Grid) -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Column 1: AI Summary and Gap Analysis (Mission Architects/Managers Focus) -->
            <div class="lg:col-span-2 space-y-8">
                <section class="p-6 bg-white rounded-xl shadow-lg border border-gray-100">
                    <h2 class="text-2xl font-bold text-nasa-gray mb-4 border-b pb-2">AI-Synthesized Briefing</h2>
                    <div id="ai-summary-container">
                        <!-- AI content will be rendered here -->
                    </div>
                </section>
                
                <!-- Relational Graph View (Scientists Focus) -->
                <section class="p-6 bg-white rounded-xl shadow-lg border border-gray-100">
                    <h2 class="text-2xl font-bold text-nasa-gray mb-4 border-b pb-2">Relational Knowledge Map Simulation</h2>
                    <p class="text-gray-500 mb-4">Visualizing the complex links between selected Factors, Organisms, and Findings (simulated Knowledge Graph Nodes).</p>
                    <div id="graph-view">
                        <!-- Graph content will be rendered here -->
                    </div>
                </section>
            </div>
            
            <!-- Column 2: Publication Results List -->
            <div class="lg:col-span-1">
                <section class="space-y-4">
                    <h2 class="text-2xl font-bold text-nasa-gray">Publication Findings</h2>
                    <p id="result-count" class="text-sm font-semibold text-gray-500">10 Results from 608 Publications (Showing 10 Mock Findings)</p>
                    <div id="results-list" class="space-y-4 max-h-[70vh] overflow-y-auto">
                        <!-- Results will be rendered here -->
                    </div>
                </section>
            </div>
        </div>
    </div>

</body>
</html>
